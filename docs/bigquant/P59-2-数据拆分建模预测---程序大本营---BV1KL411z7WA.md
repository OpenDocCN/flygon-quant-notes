# P59：2-数据拆分建模预测 - 程序大本营 - BV1KL411z7WA

继续往下看，那我们接下来就看一下数据的拆分啊，我们一共有多少个数据呀，506个样本，506个数据，对不对呀，那咱们呢要怎么拆分呢，咱们把它拆分成两份啊，大家看啊，咱们把它拆分成两份。

那拆分拆拆分成这两份，它的作用是什么呀，哎其中一份咱们让他占80%，那这80%呢就是咱们的训练数据，那还有一份呢是不是就剩下20%呀，这个20%呢就是咱们的验证数据，就是那我们拿出其中的80%。

那咱们拿出其中的80%，咱们呢交给算法去嗯，交给咱们的算法，这里所说的算法就是线性回归了，让这个算法呢去学习去总结是吧，根据最小二乘法去拟合它的一个函数对吧，让它拟合一个函数，那这个函数。

不就表明了数据和房价之间的关系嘛，对不对是吧，哎80%的数据一般情况下就足够了啊，那我们保留了20%，对不对呀，那这20%它的作用是什么呀，上面咱们进行了训练，对不对啊。

下面咱们是不是就得进行相应的验证呀，哎那这个验证呢就是测一测，是不是，看看嗯，看看咱们的算法学习结束了是吧，学习了80%的数据，学习80%的数据结束了，看看呢是否不准确，我们当然希望它准确，对不对呀。

越准确是不是说明这个算法的效果就越好呀。

![](img/34e8b83fe9331215f248b104d2e8eda2_1.png)

没错吧，是不是，那咱们该如何进行划分呢。

![](img/34e8b83fe9331215f248b104d2e8eda2_3.png)

在这里呢给各位小伙伴介绍一个方法，那大家玩过扑克吗，你一局扑克结束了，那我们的扑克是不是得需要洗牌啊，洗牌它的作用是不是就是打乱顺序啊，好那么我们np当中也有一个方法，它的作用呢也是打乱顺序。

这个时候呢你看我给你举一个例子啊，n就等于a呢，就等于np点，咱们来一个a瑞，来一个中括号，1234567好，大家看现在呢我们有这么几个数据，那此时呢我们就调用np点。

random当中有一个方法叫shuffle，这个英语单词shuffle翻译成中文。

![](img/34e8b83fe9331215f248b104d2e8eda2_5.png)

它就有洗牌的意思，你看我把a放到这，这个时候咱们一执行，然后再输出a。

![](img/34e8b83fe9331215f248b104d2e8eda2_7.png)

各位小伙伴，你就能够看到顺序是不是就被打乱了，看到了吗，原来的时候是不是123456，打乱顺序之后，是不是就变成了4267135呀，我在执行这个代码嗯，各位再来看一下，这个时候是不是又被洗牌了呀。

是不是顺序又被打乱了，好那么我们506个样本，它是不是它的索引，是不是就是从0~505呀，那么咱们现在呢就可以创建它的索引了，来咱们这样来操作，我们给一个index。

就等于np点使用咱们之前所学的方法好，这个里边呢咱们给一个506，那这个时候咱们index呢就是咱们数据的索引，此时呢我们将index怎么样顺序打乱，查看一下index。



![](img/34e8b83fe9331215f248b104d2e8eda2_9.png)

这个时候你来看你看顺序是不是打乱了，看到了吧，哎这是506个数据是吧。

![](img/34e8b83fe9331215f248b104d2e8eda2_11.png)

索引从0~505，但这个时候顺序打乱了好。

![](img/34e8b83fe9331215f248b104d2e8eda2_13.png)

那么顺序打乱了之后呢，哎咱们就可以进行相应的操作了，我们说80%的数据，是不是作为训练数据啊，好那80%的数据它大概是多少呢，你看500x500x80%，是不是400个呀对吧，6x8是不是四呀对吧。

684 18是吧，那咱们就把其中的400，把其中的这个呃405个数据是吧，我们就拿出来作为咱们的训练数据好不好，那怎么取呢，看啊这个时候咱们就来一个x冒号，我们让它切片到405。

你看这个时候是不是就是咱们的训练数据啊，咱们起个名啊，我们就叫train好不好，你看这个train叫train什么呢，下划线index，那另外一部分咱们就叫什么呀，它是不是就是验证啊，验证的话。

咱们起个名字叫task index，也来一个索引index，中国二冒号，这个时候咱们从400 051直切到最后好，有了对应的索引了，那咱们现在就是不是，可以根据索引来进行切片了，上面的数据是不是x啊。

咱们就x中括号，咱们将train index放进去，你看此时我得到的数据是不是就是训练数据啊，对不对，那我们说数据和目标值是不是一一相关的呀，然后呢咱们再给一个外传。

外传呢就等于y中括号train index，好，此时咱们得到的这个数据呢，就是80%的训练数据，来咱们做一个注释，这个呢80%唉，他呢就表示训练数据，那我执行输出一下，咱们呢给各位小伙伴打印输出一下。

咱们来一个display好不好，x下划线串点shy。

![](img/34e8b83fe9331215f248b104d2e8eda2_15.png)

下划线串点ship，这个时候你看我一直行，咱们查看它的形状啊，这个时候你看我一执行是多少，是不是都是400 054百零五呀，对不对，哎所以大家要明白咱们上面这个操作啊，各位小伙伴大家呢要仔细听啊。

仔细听，这个其实应用的知识，就是咱们之前所学到的南派唉。

![](img/34e8b83fe9331215f248b104d2e8eda2_17.png)

它当中的知识点好，那么80%的训练数据有了，接下来咱们再来给20%的这20%，是不是我们的测试数据呀，好那么同样的操作，同样的方法，咱们将数据给它切片切出来，好不好，好。

那么上面你看我的命名是不是叫做x train，那相同的操作，相同的规范，咱们给测试数据起个名叫x test，那这个时候呢咱们将test index放进去，那和这个数据所对应的，和这个数据所对应的目标值。

咱们就叫y test，同样也来一个切片，将索引放进去好，那么咱们获取了数据打印输出一下它的形状，看一下这个形状是否对应，以后你的代码出现问题了，其实呢你也要一点一点的去定位错误。

那我们定位错误非常好的一个办法，就是在出错之前的那一行代码。

![](img/34e8b83fe9331215f248b104d2e8eda2_19.png)

打印输出一下是吧。

![](img/34e8b83fe9331215f248b104d2e8eda2_21.png)

大家现在就能够看到数据是不是就有了呀，101和13好。

![](img/34e8b83fe9331215f248b104d2e8eda2_23.png)

数据拆分咱们就搞定了，这里边没有特别难的知识点吧。

![](img/34e8b83fe9331215f248b104d2e8eda2_25.png)

对不对啊，其实呢都是我们之前所学到的内容，咱们又进行了一个应用。

![](img/34e8b83fe9331215f248b104d2e8eda2_27.png)

重复性的一个应用，好接下来呢咱们再来一个四级标题好，那么这个呢咱们就开始去数据建模了。

![](img/34e8b83fe9331215f248b104d2e8eda2_29.png)

诶大家看啊，我们把它起一个名字叫数据建模，你在大学的时候有没有参加过建模比赛呀，对吧，啥是建模呢，哎模不就是模型吗，啥是模型啊，模型不就是算法吗，对不对，它俩是相同的一相同的一个意思哈，哎不同的叫法好。

那么我们现在已经学习了算法，我们学习到的这个算法唉，咱们起个名就叫做model，我们声明一个linear regression，那这个里边有一个参数。

默认情况下它的feat intercept是不是等于true呀，咱们呢也给他一个true啊，大家看我们也给一个true，也就是说进行训练的时候，咱们允许它计算我们的洁具是不是好，那么建模怎么建呢。

把咱们已有的数据看，我们说建模建模是吧，那这个地方的问题其实就是如何构建，那这个膜呢，唉这个模型的膜它是什么，这个模型的模哎，它不就是咱们的算法吗，那不就是咱们所说的方程嘛，对不对好。

那么咱们就feat一下，咱们将数据x下划线train放进去，然后呢，把它所对应的目标值外衬放进外衬放进去，大家看，这个时候咱们就建模完成了，那建模完成之后。



![](img/34e8b83fe9331215f248b104d2e8eda2_31.png)

咱们display一下，看到了吗，display是不是就是展示呀，那这个模型到底长什么样呢，对不对，那咱们就model点，我们是不是可以得到它的斜率，然后呢咱们在model。intercept。



![](img/34e8b83fe9331215f248b104d2e8eda2_33.png)

这个是不是可以得到它的截距呀，这个时候你看我一执行。

![](img/34e8b83fe9331215f248b104d2e8eda2_35.png)

大家看咱们这个数据是不是就出来了，看到了吧，得到的这个数据，我们我们发现它这个地方使用的是科学计数法，对不对，如果说你看科学计数法不爽，那可以怎么样的操作呢，np。set，咱们把它的输出打印，这是吧。

进行一个设置，咱们就叫做super price是吧，我们给他来一个true啊。

![](img/34e8b83fe9331215f248b104d2e8eda2_37.png)

这个时候再来执行，各位小伙伴，你就能够看到这个结果是不是就出来了呀，看到了吗，这个结果就出来了，好，那么此时咱们就发现你看有的数是正的比较大，有的数是负的比较大，是不是啊，唉那这个数值的大小。

数值的大小有什么关系呢，各位小伙伴想一下是吧，咱们得到的斜率啊，咱们经过建模，我们就获取了斜率，对不对，那斜率呢有大有小，有正有负，是不是斜率它有大有小，是不是有正有负呀，对不对，他表示什么呢。

唉你来思考一下啊，哎思考一下来，我们讨论区呢青兰小伙伴说了一个加权是吧，那这个数值正表示什么，数值负又表示什么呢，哎这个正正表示什么，你看这个正表示什么，唉正呢它就表示正相关，那正相关是啥意思。

就是越大越好，对不对，正相关就是越大越好，咱们举一个例子，比如说咱们说房间这个房的面积，你看这个面积一般情况下来说是不是越大，咱们的房价是不是就越高呀，对不对，你比如说嗯这个上海的。

你要去过这个汤臣一品是吧，那它的一层呢是600平，那这个一个房间就是说一呃一个屋一个屋是吧，嗯就是人家这个房子是吧，汤臣一品是吧，一层就是一户人家多少钱呢，2亿是不是基本上就是一平米30万是吧。

所以说你看面积越大是吧，位置越好，是不是，所以各位小伙伴，我现在是买不起了，就靠你们了啊，嗯看好你们好，咱们面积越大，是不是房价越高呀，对不对，那我们还有一个负呢，对不对，那这个负表示什么呀。

是不是刚好相反，对不对，你看这个负呢就是刚好相反嗯，那刚好相反，咱们就举一个例子，比如说犯罪率是不是你看你犯罪率越高，这个房价肯定越低，是不是你比如说环境污染对不对，你看你环境污染越严重。

是不是这个房价就掉的越厉害，对不对，所以说咱们现在明白这个正和负了啊，好那么我们就想看一下这个值是吧，它是3。55，那这个对应着哪，对应着哪一个特征呀。

来咱们现在获取一下它的feature names是吧。

![](img/34e8b83fe9331215f248b104d2e8eda2_39.png)

大家看啊，这个时候你看我自动补全是不是多了个e呀，因为我的手速太快是吧，多了个e是吧，咱们再来执行啊，现在咱们就能够看到，你看这个第四个代表什么啊，咱们看一下啊，这个crime是吧。

这个z n industry叫做c h a s，你看这个是不是对应着这个呀，我们看一下这个c h a s，这个代表着这个3。55好，那么我们后面这个，咱们是不是做了一定的解释呀。

那这个n o x这个表示什么呀，这个是不是表示环境污染呀对吧，空气中氮的含量，你氮的含量越高，说明这个污染就越严重，所以说你看它是不是负相关，后面还有一个什么，还有一个rm。

这个rm呢就是咱们房屋当中咱们卧室的数量，你想卧室的数量越多，这个房价是不是越贵呀，你看比尔盖茨的豪宅，是不是这个卧室那几十个上百个是吧，所以说你看卧室越多，房价房价越高，在咱们中国也是三使的。

它是不是就比两室的，是不是要要这个价格贵一些啊，那咱们接下来看一下这个代表什么啊，你看这个c h a s是不是这个。



![](img/34e8b83fe9331215f248b104d2e8eda2_41.png)

因为是国外的这个房价数据啊。

![](img/34e8b83fe9331215f248b104d2e8eda2_43.png)

那为了让为了让你这个清楚一些是吧，咱们在这个加载数据的下一行，我们插入一行，咱们将这个波士顿是吧。

![](img/34e8b83fe9331215f248b104d2e8eda2_45.png)

这个数据呢我们给它输出一下，哎你看这个时候我一执行，那下面呢它它都有相应的说明。

![](img/34e8b83fe9331215f248b104d2e8eda2_47.png)

比如说咱们就找一下，看这个代表什么啊，看这个啊，看这个代表什么啊，这个叫做c h a s叫做查尔斯river，哎这个就是唉这个在波士顿非常著名的一条河，看在波士顿非常著名的一条河，也就是说你你的房子呢。

唉假如说要在江边儿的话，那你想这个房价是不是就贵呀，景色是不是就比较好呀，唉所以说这个这个查尔斯呢，他呢也是跟它呢，也是跟咱们的这个房价有关系的啊，你看这个如果这个数据等于一是吧，这说明什么呢。

叫棒子river是吧。

![](img/34e8b83fe9331215f248b104d2e8eda2_49.png)

棒子river哎这个就叫海景房，是不是你到了青岛就知道了。

![](img/34e8b83fe9331215f248b104d2e8eda2_51.png)

那海景房老贵了，是不是啊，所以这个就叫江景房哎一个意思啊，所以这就是咱们差啊，这这就是咱们这个这个chaos是吧，它的这个呃一个含义啊，好那么咱们进行了相应的介绍。



![](img/34e8b83fe9331215f248b104d2e8eda2_53.png)

我们呢又把特征，又把咱们的这这些这个属性拿出来，和咱们的系数进行了一个对比，咱们发现基本上来说是不是比较靠谱呀是吧，跟我们这个印象当中的这些趋势。



![](img/34e8b83fe9331215f248b104d2e8eda2_55.png)

它呢是对应上的好，那么数据建模咱们就搞定了，那这个model呢就是一个方程，大家注意啊，数据建模搞定了是吧，那咱们的model m o d e l它其实本质是什么，它的本质就是一个方乘好，那么有了方程。

咱们是不是就可以使用方程来预测了。

![](img/34e8b83fe9331215f248b104d2e8eda2_57.png)

上面咱们是不是保留了20%的数据。

![](img/34e8b83fe9331215f248b104d2e8eda2_59.png)

来作为测试数据，对不对，那我们就验证一下，看一下你咱们这个模型。

![](img/34e8b83fe9331215f248b104d2e8eda2_61.png)

咱们这个方程到底好用不好用，然后呢咱们来一个四级标题，这个呢就叫做模型的验证。

![](img/34e8b83fe9331215f248b104d2e8eda2_63.png)

或者说呢叫做模型的应用好，那么咱们现在呢就来一个model，那该怎么去应用呢，叫predict来，各位小伙伴，你来告诉我predict这个英语单词，它是什么意思呢，这个是不是就有预测的意思啊，对不对呀。

好那么来我们就预测一下预测谁，我们将保留的20%的数据放到这儿。

![](img/34e8b83fe9331215f248b104d2e8eda2_65.png)

那既然有一个预测，这个时候你看我一执行看到了吧。

![](img/34e8b83fe9331215f248b104d2e8eda2_67.png)

预测数据是不是就出来了，那预测数据出来之后，咱们保留的位数有点多啊，咱们来一个round，我们就让它保留两位，是不是就行了啊。



![](img/34e8b83fe9331215f248b104d2e8eda2_69.png)

对不对，我们来一个run的啊，看这个时候一执行，现在你看保留两位，看上去是不是就嗯这个嗯舒服一些了，好那么咱们预测之后的结果，我们起个名叫歪盖，咱们之前在讲课的时候，咱们说这个方程预测的值。

咱们是不是给他戴了一个帽子呀，是不是你看y上面是不是戴着一个帽子，是不是表示咱们的预测，那我们在写代码的时候，咱们没有办法往上面给它加一个向上的小于号，所以说一般情况下。

我们都在它的右下角给它加一个盖儿，这是英文状态下输入的这个减号是吧，英文状态下你按住shift是吧，就可以输出咱们的下划线，短的下划线好，那么一般情况下呢，一般情况下呢在机器学习当中。

咱们的歪盖呢它往往表示咱们模型预测的结果，好，模型预测的结果咱们往往是这种形式。

![](img/34e8b83fe9331215f248b104d2e8eda2_71.png)

那就是y它的右下角带着一个盖，你观察一下。

![](img/34e8b83fe9331215f248b104d2e8eda2_73.png)

你看他的q if它的右下角带着一个什么，是不是下划线杠呀。

![](img/34e8b83fe9331215f248b104d2e8eda2_75.png)

intercept它的右下角带着一个什么，是不是下划线杠呀，所以我们也模仿它，是不是咱们让y杠下面呢，我们让y右下角也有一个它好，那么大家看啊，这个就是咱们预测的结果，那这个结果很多是吧，他101个。

咱们呢给他展示前多少个呀。

![](img/34e8b83fe9331215f248b104d2e8eda2_77.png)

咱们给他展示前30个好不好，哎，这个时候执行大家看这就是前30个。

![](img/34e8b83fe9331215f248b104d2e8eda2_79.png)

那这是预测的，那你预测的到底好不好呢，来咱们看一下我们的保留的真实值，真实值是不是y test和，x test对应的值是不是y test好，那么我们也查看一下y test的前30个。



![](img/34e8b83fe9331215f248b104d2e8eda2_81.png)

这个时候呢咱们对比一下啊，看一下这个算法到底准不准，好不好好，那么这个时候各位小伙伴就能够看到，你看你的第一个房子，算法预测出来是不是14。5，咱们这个这个房子它真实的标价是不是19呀。

当然这个房价是不是会随着各种因素的变化，是不是会出现一个波动呀，对不对，你看第二个房子呢，你看第二个房子算法给你估算出来，你大概呢就值20万是吧，但是标的这个价格是24，我们看第三个是吧，这个5。52。

你看这个是8。4是吧，我们看啊，这个是12。9，这个是多少，这个是15。6是吧，然后这个是32。7是吧，那这个是不是就是29。8呀，它在一定的范围内波动，这个呢还可以接受啊，因为我们说了咱们的算法是吧。

在预测某一些目标值的时候，你看它不是百分之百的，再说了，你下面这个y test，他一定就是房子的这个真实价格吗，对不对，你看这个呢只是它标价是不是标出来的呀，你房子标价标出来了，如果你标的高。

那请问有人买吗，标的高是不是就没有人买了呀，对不对，你看你标价标的高，那就没有人买了，是不是，那有的房子呢你看它价格比较高，但是它标价标的比较低，你知道为什么吗，你看你看这个哎咱们换一个颜色啊。

你看这个是吧，算法预测出来是多少，是不是你要卖32万啊，但是这个呢，你看他是不是就只卖了29。8万呀，因为呢他急于出手，是不是算了吧，他急于出手，那我们的这个算法预测出来的这个数据呢。

偶尔也会有异常值对吧，偶尔也会有异常值，这个呢是不可避免的啊，知道吗，哎这个是不可避免的，我告诉你为什么啊，比如说是吧，你看有一个江景房是吧，位置也特别好是吧，房型也特别好，嗯是吧，三室两厅。

但是这个价格就是卖不上去，为什么呀，这是一个凶宅，是不是前三户是吧，这个前住这个房子的是吧，前三户人家全给全给，因为不明原因是吧，哎给死掉了，那你想这个房子它能卖出去吗，是不是就卖不出去了。

哎咱们再比如一个房子是吧，农村里边是吧，有有的房子是吧，特别贵是吧，国家都不让卖，为啥呀，对不对呀，他从小住的房子，你想现在都不允许翻盖，是不是依然要保持他的原来的样子，这个是不是都成了历史文物了。

对不对，所以说呢像房价这种东西是吧，哎它呢受很多因素的影响啊，好那么各位小伙伴我们就能够看到，你看这个是不是就咱们模型的验证呀，咱们就发现是吧，使用线性回归，我们在对这个房价进行预测的时候还行啊。

还可以，是不是，所以嗯嗯所以你像贝壳呀是吧，还有这个链家呀，或者说其他的这些大型的房地产互联网，这个嗯这个卖房的这个公司，他们都使用了相应的算法，唉为你的房子来进行评估估价，知道吗。

唉都有广泛的一个应用好，那么呃到这儿呢。

![](img/34e8b83fe9331215f248b104d2e8eda2_83.png)
# P29：2-基于百分位去极值实例 - 人工智能博士 - BV1aP411z7sz

接下来咱们要完成这样一个操作，我说现在这个数据啊，它的一个范围我就不管了，我说现在那Q1我们能算，Q3我也能算，我说小于这个Q1的，那就都等于Q1吧，大于这个Q3的，咱就全等于Q3，是不是行啊。

相当于数据你给它规范到一定的范围当中吧，我们要做这样一件事儿，好了，咱们来看一下吧，怎么样去做，首先我先指定个列名啊，对哪个列执行这样操作，我随便选一个，咱们只是举例子，也不选什么因子了。

随便选择一个列，好了列选完了，那接下来，我说要写个函数了，这个函数啊帮我去做了，我们当前的一个过滤操作，过滤操作谁呢，是不是说我们现在啊，对我的这个集值来去执行，咱们当前的一个按照什么，百分比吧。

其实这里啊，我说的是一个按照一个Q1还有Q3，那你说按照一个别的百分比，咱能不能去做呀，是不是也行啊，哎，这是我们写了个函数，在这里我们要过滤，那一会呢，我会传递数据啊，数据这是一个data。

data当中我们选了一列，是不是选了一列一会儿，那一列是什么，一列它是不是一个Ceres结构啊，所以说我传进来的就是一个Ceres，然后呢，你还得告诉我什么，哎呦，你的一个最小，哎。

你想保留的是一个百分之多少呢，可以比如说这个Q1拿百分之二十五，可以吧，一会你可以自己改这个参数，然后再来一个参数，我说最大你想保留多少呢，这个任务当中，咱是不是就是一个百分之七十五啊，好了。

在这里我们来写一下，写吧，第一步干什么，哎，你说数据，你看一开始数据啊，都是有大有小有大有小的，不一定吧，那你说当我们去做这个中位数的时候，那数据怎么样，那是不是得按照从小到大，你得做一个排序啊。

所以说第一步咱们要对数值，哎，完成这样一个排序的操作，因为只有啊，你的一个排序完了，你才能去算，哎，中间那个是哪，百分之二十五是哪，百分之七十五是哪吧，好了，对于Ceres来说，我说呀。

我说对他做一个排序，Sort Value一下，Sort Value，那就默认，他就是一个从小到大排序的Ceres，等于他当前的一个排序结果，这个是我对咱们当前这一列数据啊，重新做排序了。

重新排序完之后啊，然后你是不是得告诉我，哎，现在你这里边，你只给我传说一个百分之二十五，和一个百分之七十五，哎，我说我是不是得知道啊，这个百分之二十五是等于哪个数啊，百分之七十五是等于哪个数。

我一会好做对比，哎，小于这个数的都得这个数，大于那个数的哎，都得最就都得那个大于那个数，是不是，我得把这个最小和这个最大两个数算出来吧，行了，我说这里啊，咱说我现在有一个Q吧，Q就是我的一个啊。

这里边存的就是我一会的一个最小的和一个最大的，好了，把这个Ceres拿到手，哎，这里咱们可以直接有个函数，帮我们去完成这样一个计算的操作，哦，挺简单的，就是在这个判断当中，很多函数咱都可以直接用起来。

这个函数意思这样就是当前啊，你往这里边输进来了一个区别，然后呢，你给我输入了两个参数，比如说你输一个零点二五和一个零点七五，他就实际帮你算一下，哎，在这在在这个Q1和这个Q3位置，它的值分别是多少。

所以这块啊，我把这个最小值一个，哎，这会里边里边你传进来，就是传进来的是一个list，list当中，你说你要把数据当中你算哪些个值，我说算最小的零点二五这个再算一个最大的零点七五这个行了，然后呢。

我说我写一个返回值吧，现在我是不是个最小有了最大有了，那接来我是不是说得对我数据干什么了，做一个规范吧，这个安排这个函数是这样一个意思啊，就是啊，这里边比如说你现在有一个，呃，一三三五七九。

然后十一十三吧，然后这一块你要传进来三个参数，第一个参数就是你这个序列，像咱们直接一会儿把这个zero传进去行，然后第二个参数就是你希望这个序列当中啊，一个最小值是多少一个min。

然后第三个参数就是你希望这个序列当中啊，最大的一个值，哎，它是多少，哦，我们要写三个参数，然后比如说你最小值它是等于三的，最大值是等于一个11的，那它会返回什么，返回的也是一个序列啊。

只不说这个序列我拿蓝色化，这个序列它就变成这样了，你看第一个值小于三吧会变成什么，小于三的哎，都变成三了，这有三三，然后呃三五七九十一最后什么，也是一个十一吧，啊，相当于把所有数据啊做了一个规范。

在这里哎，我们有三个参数，第一个参数，我的一个zero啊，我们当前的这个序列第二参数呢，在这个Q当中啊，它会有两个返回值啊，返回是第一个就是它这个最小，因为这个序列当中我不是传见两个吗。

所以说它里边就会有这么两个值，那最小值我IOC一下，它就是一个零是吧，要接来Q再点IOC一下，然后第二个值最大值，它就是一个一好了，这样我们就把当前这个函数给它写完了吧，相当于哎，我们对应用方法。

这个方法呢，按照啊，我传进来一个就是一个series啊，一组数对这种数啊，我选了哎，最小多少最大多少，然后呢，你按照我当前这个比例把我这个数据做一个规范啊，这样我们就可以完成一个去极值的操作吧，好了。

这里啊，咱们先把哎，我们的一个函数给它写完了，这个代码啊，咱们是写完了，那接下来看一看它去极值的一个效果吧，在这里我们来去执行一下执行这个函数，然后呢，这个函数就对我数据做操作吧，然后我数据就是啊。

咱们直接写吧，数据就是data对数据当中的某一链，我把这个链名给它传进去啊，这就完事了，这样咱就完成了一个啊，基本的按照百分位啊，去一个啊，去极值的一个操作，行了，那我们去完了一个极值，哎。

咱们给它指定一个返回值，对于这个返回值来说啊，那咱们来给它画图看一看啊，现在这个结果它能长什么样子，呃，画一个图就是点plot一下，好了，这里我说，呃，哎，直接对我们这个结果吧，哎，直接对这个结果。

对我当前的这个结果，我说给它点plot一下，plot完之后，哎，这是第一步先做一个，哎呀，这样不行，这里边我们得画两个图，一个是原始的，一个是咱们做完之后的吧，好了，我们得画两个。

第一个就是一个原始的原始图啊，就是原始的一个数据，我去点plot一下，是不是就行了，然后一个新的就是我刚才做完了，我的一个规范之后，咱们再点plot一下，看一下吧，呃，看这个结果有点奇怪。

我们来检查一下，没有什么问题啊，第一步在这里，我说我是对我们当前的原始数据啊，做了这样一个操作，第二步呢，是我现在执行了一个规范化之后，然后对我这个数据，咱又执行了一个操作，从这个图上来看啊。

基本上就逻辑上没有什么问题啊，因为它已经把它的一个范围给大家画出来了，但是这个，呃，它会有些重叠，这个重叠看起来不是特别好看，这样吧，我再把这个放到下面，把这个放到上面，给它加上顺序。

这样大家能够看得会更明显一些啊，它就是说，呃，这块它出现了一些什么，哎，它有一些比这个当前这个只可能是60左右，比它小的，那应该等于这个蓝色的，这块呢，有些大的，有些大的应该等于什么，也应该等于蓝色的。

这个是给大家先从图上，咱简单的要一行啊，主要是说，哎，咱们的一个流程啊，该怎么去做啊，这我刚才给他打印了一下，给他删掉，行了，这样我完成第一步啊，就是我们的第一种方法啊。

在及时数据当中怎么样根据一个分位数去去这个及时，可能在实际操作当中啊，呃，不可能说你指定个这么大一个值，0。25，0。75，这个相对来说是太大了，你把绝对多数值都当做是一个异常点了。

可能在很多因子当中啊，我们可能什么样，0。025，0。975，是吧，这两个值可能是会更常用一些啊，但是我们今天例子里啊，没给大家展示的明显一点，所以说啊，我把这个值可能在有些地方，在他啊。

稍微的放大了一点啊，大家明白这个意思就行，实际当中啊，我们的范围应该会更小一些啊。

![](img/68010a80172fc1f2215f0535db075163_1.png)

这个是百分数去去去积值。
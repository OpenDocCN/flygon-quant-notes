# P37：3-因子数据预处理 - 人工智能博士 - BV1aP411z7sz

然后进来呃，指标常用完了之后，那是不是说我们得做这个啊预处理操作了，预处理操作在这个预处理操作当中啊，咱是不是就是之前给大家说了，咱们的三步走，第一步要去极值，第二步标准化。



![](img/e516f8bde93c083e9fafcbebdc9490fd_1.png)

第三步中性化啊，好了咱们来写啊，第一步我们要做一个呃去极值聚集时啊。

![](img/e516f8bde93c083e9fafcbebdc9490fd_3.png)

反而挺多，咱们简单点就用这个三西格玛哎。

![](img/e516f8bde93c083e9fafcbebdc9490fd_5.png)

这个比较好用，然后呢第二步第二步啊，我说我要做一个什么，做一个标准化啊，就是一个STARD呃。

![](img/e516f8bde93c083e9fafcbebdc9490fd_7.png)

做一次上一个standard一个操作，然后呢第三步第三步啊。

![](img/e516f8bde93c083e9fafcbebdc9490fd_9.png)

咱们说要做一个中性化的一个操作。

![](img/e516f8bde93c083e9fafcbebdc9490fd_11.png)

咱们来写一下，完成我们当前的一个中性化的操作行了，就这三步就可以了，呃这也这样吧，咱们先把三个函数我们写完，然后呢写完三个函数之后，咱们再来去在这里直接去调啊，相当于离群值。



![](img/e516f8bde93c083e9fafcbebdc9490fd_13.png)

你要自己写函数，然后标准化自己写，然后中心化也自己写，比较麻烦啊，先写第一个，第一个就是一个聚集值啊，再来写一下BT，这是什么呢，filter一个三啊，西格玛就行了，在这里啊，咱们来想一想。

我传入是什么，那是不是传入一个指标啊，然后呢咱之前说了。

![](img/e516f8bde93c083e9fafcbebdc9490fd_15.png)

是不是个三个MN等于什么，N等于三吧，好了，接下来咱们来写第一步。

![](img/e516f8bde93c083e9fafcbebdc9490fd_17.png)

在三个词语法当中，哎你是不是得数啊，我得算出来均值和标准差啊，好了写一下啊，我们的一个均值还有标准差，在这里我们的一个均值比较简单啊，跟咱们之前写的一都是一模一样的，在这里就是一个点面。

然后STD就是它的一个点STD就行了，那接下来就是一个max，还有这样一个一个面啊，咱们都分别指定一下我的一个上限，还有一个下限range，这也是一个range等于什么，就等于哎我当前的一个均值。

然后加上或者是减去多少倍的一个哎。

![](img/e516f8bde93c083e9fafcbebdc9490fd_19.png)

就是加上一个N倍，这里就是30码三乘上我当前的一个STD。

![](img/e516f8bde93c083e9fafcbebdc9490fd_21.png)

所以想了，然后这一块下面都是一样的，只不过说它就是一个减号，咱就完事了，这样就完成了第一个啊，相哎这还没完成，还得给特一个值return，在你的安排当中，我得把这些值不是真正的去掉。

而是把它做一个规范啊。

![](img/e516f8bde93c083e9fafcbebdc9490fd_23.png)

在这里serious给它传进去，然后我们两个参数的两个界限在指定好。

![](img/e516f8bde93c083e9fafcbebdc9490fd_25.png)

这就行，第一个界限，然后还有我们的第二个界限好了。

![](img/e516f8bde93c083e9fafcbebdc9490fd_27.png)

这是一个我们的来写下吧，这里这波操作把我们的一个呃去离群点吧，或者是去啊极值吧，去极值操作好了，接下来我们再来写还有什么，接下来就是我们第二个第二个当中呃，要去做这样一个标准化，我们来写标准化操作好了。



![](img/e516f8bde93c083e9fafcbebdc9490fd_29.png)

写一下，我们重新创建一个函数。

![](img/e516f8bde93c083e9fafcbebdc9490fd_31.png)

在这个函数当中啊，咱们来写标准化操作其实也是挺简单的，像我干什么。

![](img/e516f8bde93c083e9fafcbebdc9490fd_33.png)

其实方法都是一样的，都是需要咱们去计算出来AUDANGERTAND，都是需要我们去计算出来一些指标吧，好了，然后咱们一个丹德，这叫散子得了了。



![](img/e516f8bde93c083e9fafcbebdc9490fd_35.png)

在这里我们来直线一下标准化操作当中啊，咱们要做这样一件事，首先还是这两个值。

![](img/e516f8bde93c083e9fafcbebdc9490fd_37.png)

这样值物都可以直接复制过来了，这样直接复制过来。

![](img/e516f8bde93c083e9fafcbebdc9490fd_39.png)

然后我的一个参数也是直接复制过来，然后这块他直接return一个结果，return一下咱这一个series，然后减去一个me，然后呃在就这唉再比上这样一个标准差小，再比上一个STD就完事了。

这是个标准化操作吧，好了咱们也下一个。

![](img/e516f8bde93c083e9fafcbebdc9490fd_41.png)

下一个之前是不是没写过叫中性化操作呃。

![](img/e516f8bde93c083e9fafcbebdc9490fd_43.png)

中心化是这样，我们在中心化当中啊，咱之前说了，我们要干什么，是不是啊，唉我说要去做一个回归方程啊，在这个回归方程当中我们要干什么，师傅说第一步，哎，我滴妈，这个回归方程给他怎么样给它求解出来吧。

求解完出来之后呢，我作为一个natural得了求解完出来，求解出来之后，我说咱们要用一个真实值减预测值，剪完之后，相当于诶我这个因子，它自身应该自身的一个价值是等于多少吧，但是咱们来想一想。

这里有需要几个参数啊，哎这里咱们需要几个参数，咱们之前是不是说了，我看一下这个市净率来跟我试值之间的关系啊，那其实对于我们的一个市净率来说，它是啥，它是我们这个因子吧，就是我们这个factor。



![](img/e516f8bde93c083e9fafcbebdc9490fd_45.png)

然后呢我们要要拿这个factor跟谁做对比啊，是不是跟刚才咱们拿出来这个指标啊。

![](img/e516f8bde93c083e9fafcbebdc9490fd_47.png)

我直接复制过来了，直接复制过来。

![](img/e516f8bde93c083e9fafcbebdc9490fd_49.png)

拿我们的市净率跟我们这个市值啊，做一些事了好了，把太阳拿过来，在这里呢咱们说一下，就是谁是X谁是YY是谁啊，其实这里不用写Y啊，咱们直接用这个参数写，但是让大家看的更明显一点啊，再给大家强调一遍。

Y是谁啊。

![](img/e516f8bde93c083e9fafcbebdc9490fd_51.png)

试试看我的一个市值哎，对这个factor影响有多大，那谁是YY就是我的一个音，就是咱们这个因子吧，好了，Y因子XX唉是我当前的一个市值，这没问题吧。



![](img/e516f8bde93c083e9fafcbebdc9490fd_53.png)

好了，接下来咱们之前是不是导进来一个this this models啊，哦这块咱们来指定一下。

![](img/e516f8bde93c083e9fafcbebdc9490fd_55.png)

这块我得把他的API再导进来一下呃，云盘下在这个DIMODELS当中，然后呃点RAPI。

![](img/e516f8bde93c083e9fafcbebdc9490fd_57.png)

然后一个SMSM码，这里我们要用最小二乘法来做一个求解。

![](img/e516f8bde93c083e9fafcbebdc9490fd_59.png)

所以说我得把这个state models拿到手，在这个step model当中，在这个模组当中，咱们缺点什么线性回归方程吧，说白了啊，往简单说，我们要做一个最小二乘法YS在这个OS当中啊。

我们要传递两个参数，第一个就是一个Y值，第二个就是一个X值，咱们先写Y，然后他有要求啊，就是底是一个flow类型啊，最好给它转成一个flow类型，tap下x tape成咱们的一个flow类型。

然后这是一个Y，然后接下来是xx也是一样的，传进来我们的一个标签，还有我们的一个数据，这就行了，然后呢他会把这个模型给我返回回来，我写一个result吧，这就是我的模型，在我的模型当中啊。

你说其实唉我想要的是谁啊，我想要比特人什么，是不是啊，我要return，我的一个真实值和我的一个预测值之，间的一个差异啊，好了，在这个this model当中啊，咱有个简单方法。

你直接给他什么RECEL当中，它有一个方法呃。

![](img/e516f8bde93c083e9fafcbebdc9490fd_61.png)

叫做我们的一个残差来长相。

![](img/e516f8bde93c083e9fafcbebdc9490fd_63.png)

这个叫做我们的参差，但是不是这个把DF去掉，这样咱们先返回什么，就是你去除掉了啊，在这个限微分方程当中，你把这个WI加B给去掉了，相当于把咱们市值影响啊，它的一个因素去掉了。

那这个fighter相当于是比较纯的了，咱现在就完成了一个提纯的操作啊，方法是比较简单啊，啊咱们用这个state models，他这个属性啊，直接帮我们自动的算一个差异值了，大家感兴趣。

你可以自己上一节APM当中看一下啊，这个属性直接自动的帮你做了。

![](img/e516f8bde93c083e9fafcbebdc9490fd_65.png)